<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Auth Test - TitleTesterPro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            max-width: 500px;
            width: 100%;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .status-box {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .status-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .status-item:last-child {
            margin-bottom: 0;
        }
        .status-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .status-icon.success {
            background: #4ade80;
            color: white;
        }
        .status-icon.error {
            background: #f87171;
            color: white;
        }
        .status-icon.loading {
            background: #fbbf24;
            color: white;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .status-text {
            flex: 1;
            color: #333;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            margin-top: 10px;
        }
        .btn:hover:not(:disabled) {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn.secondary {
            background: #6b7280;
        }
        .btn.secondary:hover:not(:disabled) {
            background: #4b5563;
        }
        .error-msg {
            background: #fee;
            border: 1px solid #fcc;
            color: #c00;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
        }
        .success-msg {
            background: #efe;
            border: 1px solid #cfc;
            color: #060;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
        }
        .user-info {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        .user-info h3 {
            color: #0284c7;
            margin-bottom: 10px;
        }
        .user-info p {
            color: #0c4a6e;
            margin: 5px 0;
            font-size: 14px;
        }
        .console-log {
            background: #1e293b;
            color: #94a3b8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .console-log .log-entry {
            margin-bottom: 5px;
        }
        .console-log .error { color: #f87171; }
        .console-log .success { color: #4ade80; }
        .console-log .info { color: #60a5fa; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Firebase Auth Test</h1>
        <p class="subtitle">TitleTesterPro Authentication Diagnostic</p>
        
        <div class="status-box">
            <div class="status-item">
                <div class="status-icon loading" id="firebase-status-icon">...</div>
                <div class="status-text" id="firebase-status">Initializing Firebase...</div>
            </div>
            <div class="status-item">
                <div class="status-icon loading" id="auth-status-icon">...</div>
                <div class="status-text" id="auth-status">Checking authentication...</div>
            </div>
            <div class="status-item">
                <div class="status-icon loading" id="provider-status-icon">...</div>
                <div class="status-text" id="provider-status">Configuring Google provider...</div>
            </div>
        </div>
        
        <button class="btn" id="sign-in-btn" disabled onclick="signIn()">
            Sign In with Google
        </button>
        
        <button class="btn secondary" id="sign-out-btn" style="display:none;" onclick="signOut()">
            Sign Out
        </button>
        
        <div id="message-area"></div>
        
        <div class="user-info" id="user-info" style="display:none;">
            <h3>Signed In User</h3>
            <p id="user-email"></p>
            <p id="user-uid"></p>
            <p id="user-token"></p>
        </div>
        
        <div class="console-log" id="console">
            <div class="log-entry info">Console output will appear here...</div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getAuth, 
            GoogleAuthProvider, 
            signInWithPopup, 
            signOut as firebaseSignOut,
            onAuthStateChanged 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        // Logging helper
        const logConsole = (message, type = 'info') => {
            const consoleEl = document.getElementById('console');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleEl.appendChild(entry);
            consoleEl.scrollTop = consoleEl.scrollHeight;
            
            // Also log to browser console
            console.log(message);
        };
        
        // Clear console
        document.getElementById('console').innerHTML = '';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA8hjvKfC_D1rQqIWgjhxq-xM1cmgDB3z4",
            authDomain: "titletesterpro.firebaseapp.com",
            projectId: "titletesterpro",
            storageBucket: "titletesterpro.appspot.com",
            messagingSenderId: "564429395545",
            appId: "1:564429395545:web:c5e53dec47b0aa74f23fa0"
        };
        
        let app = null;
        let auth = null;
        let googleProvider = null;
        
        // Update status UI
        const updateStatus = (elementId, iconId, status, isSuccess) => {
            const statusEl = document.getElementById(elementId);
            const iconEl = document.getElementById(iconId);
            
            statusEl.textContent = status;
            iconEl.className = `status-icon ${isSuccess ? 'success' : 'error'}`;
            iconEl.textContent = isSuccess ? '‚úì' : '‚úó';
        };
        
        // Initialize Firebase
        try {
            logConsole('Initializing Firebase...', 'info');
            app = initializeApp(firebaseConfig);
            updateStatus('firebase-status', 'firebase-status-icon', 'Firebase initialized', true);
            logConsole('Firebase initialized successfully', 'success');
            
            // Initialize Auth
            auth = getAuth(app);
            updateStatus('auth-status', 'auth-status-icon', 'Authentication ready', true);
            logConsole('Firebase Auth initialized', 'success');
            
            // Configure Google Provider
            googleProvider = new GoogleAuthProvider();
            googleProvider.setCustomParameters({
                prompt: 'select_account'
            });
            updateStatus('provider-status', 'provider-status-icon', 'Google provider configured', true);
            logConsole('Google provider configured', 'success');
            
            // Enable sign-in button
            document.getElementById('sign-in-btn').disabled = false;
            
            // Listen for auth state changes
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    logConsole(`User signed in: ${user.email}`, 'success');
                    showUserInfo(user);
                } else {
                    logConsole('No user signed in', 'info');
                    hideUserInfo();
                }
            });
            
        } catch (error) {
            logConsole(`Firebase init error: ${error.message}`, 'error');
            updateStatus('firebase-status', 'firebase-status-icon', 'Firebase initialization failed', false);
            showError(`Failed to initialize Firebase: ${error.message}`);
        }
        
        // Sign in function
        window.signIn = async () => {
            const btn = document.getElementById('sign-in-btn');
            btn.disabled = true;
            btn.textContent = 'Signing in...';
            clearMessages();
            
            try {
                logConsole('Starting Google sign-in...', 'info');
                const result = await signInWithPopup(auth, googleProvider);
                const user = result.user;
                
                logConsole(`Sign-in successful: ${user.email}`, 'success');
                
                // Get ID token
                const idToken = await user.getIdToken();
                logConsole(`ID Token obtained (first 50 chars): ${idToken.substring(0, 50)}...`, 'success');
                
                showSuccess('Successfully signed in!');
                showUserInfo(user);
                
            } catch (error) {
                logConsole(`Sign-in error: ${error.code} - ${error.message}`, 'error');
                
                let userMessage = 'Failed to sign in. ';
                if (error.code === 'auth/popup-closed-by-user') {
                    userMessage += 'Sign-in cancelled.';
                } else if (error.code === 'auth/popup-blocked') {
                    userMessage += 'Please allow popups and try again.';
                } else if (error.code === 'auth/unauthorized-domain') {
                    userMessage += 'This domain is not authorized. Add it to Firebase Console.';
                } else if (error.code === 'auth/operation-not-allowed') {
                    userMessage += 'Google sign-in is not enabled in Firebase Console.';
                } else {
                    userMessage += error.message;
                }
                
                showError(userMessage);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Sign In with Google';
            }
        };
        
        // Sign out function
        window.signOut = async () => {
            try {
                logConsole('Signing out...', 'info');
                await firebaseSignOut(auth);
                logConsole('Sign-out successful', 'success');
                showSuccess('Successfully signed out!');
                hideUserInfo();
            } catch (error) {
                logConsole(`Sign-out error: ${error.message}`, 'error');
                showError(`Failed to sign out: ${error.message}`);
            }
        };
        
        // UI Helper functions
        const showError = (message) => {
            const messageArea = document.getElementById('message-area');
            messageArea.innerHTML = `<div class="error-msg">${message}</div>`;
        };
        
        const showSuccess = (message) => {
            const messageArea = document.getElementById('message-area');
            messageArea.innerHTML = `<div class="success-msg">${message}</div>`;
        };
        
        const clearMessages = () => {
            document.getElementById('message-area').innerHTML = '';
        };
        
        const showUserInfo = async (user) => {
            document.getElementById('user-info').style.display = 'block';
            document.getElementById('user-email').textContent = `Email: ${user.email}`;
            document.getElementById('user-uid').textContent = `UID: ${user.uid}`;
            
            const token = await user.getIdToken();
            document.getElementById('user-token').textContent = `Token: ${token.substring(0, 50)}...`;
            
            document.getElementById('sign-in-btn').style.display = 'none';
            document.getElementById('sign-out-btn').style.display = 'block';
        };
        
        const hideUserInfo = () => {
            document.getElementById('user-info').style.display = 'none';
            document.getElementById('sign-in-btn').style.display = 'block';
            document.getElementById('sign-out-btn').style.display = 'none';
        };
        
        // Test API connection
        const testAPIConnection = async () => {
            try {
                const response = await fetch(`https://identitytoolkit.googleapis.com/v1/projects/${firebaseConfig.projectId}/config?key=${firebaseConfig.apiKey}`);
                if (response.status === 404) {
                    logConsole('WARNING: Firebase Auth API may not be enabled', 'error');
                    showError('Firebase Authentication is not enabled. Please enable it in Firebase Console.');
                } else if (response.ok) {
                    logConsole('Firebase Auth API is accessible', 'success');
                }
            } catch (error) {
                logConsole('Could not verify Auth API status', 'error');
            }
        };
        
        // Run API test
        setTimeout(testAPIConnection, 1000);
    </script>
</body>
</html>